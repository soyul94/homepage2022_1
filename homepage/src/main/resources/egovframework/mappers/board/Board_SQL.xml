<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.let.board.service.impl.BoardMapper"> <!-- 이 mapper namespace가 찾아가는 경로이므로 꼭 정확히 명시해야한다. -->

	<select id="selectBoardList" resultType="egovMap">
		SELECT
			A.BOARD_ID,
			A.BOARD_SJ,
			A.BOARD_CN,
			A.INQIRE_CO,
			A.CREAT_IP,
			A.NOTICE_AT,
			A.OTHBC_AT,
			A.USE_AT,
			A.ATCH_FILE_ID,
			A.FRST_REGIST_PNTTM,
			A.FRST_REGISTER_ID
		FROM BOARD A
		<include refid="selectBoardListWhere"/>
		ORDER BY A.FRST_REGIST_PNTTM DESC
		
		<if test='noticeAt != "Y"'>
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		</if>
	</select>
	
	<select id="selectBoardListCnt" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM BOARD A
		<include refid="selectBoardListWhere"/>
	</select>

	<sql id="selectBoardListWhere">
		<where>
			A.USE_AT='Y'
			<choose>
				<when test='noticeAt=="Y"'>
					AND A.NOTICE_AT = 'Y'
				</when>
				<otherwise>
					<if test='searchCondition != null and searchCondition != ""'>
						<choose>
							<when test='searchCondition == "0"'>
								AND A.BOARD_SJ LIKE CONCAT('%',#{serchKeyword},'%')
							</when>
							<when test='searchCondition == "1"'>
								AND A.BOARD_CN LIKE CONCAT('%',#{serchKeyword},'%')
							</when>
							<when test='searchCondition == "2"'>
								AND A.FRST_REGISTER_ID LIKE CONCAT('%',#{serchKeyword},'%')
							</when>
						</choose>
					</if>
				</otherwise>
			</choose>
		</where>
	</sql>
	
	
	<insert id="insertBoard" parameterType="egovframework.let.board.service.BoardVO">
		insert into BOARD(
			BOARD_ID,
			BOARD_SJ,
			BOARD_CN,
			INQIRE_CO,
			CREAT_IP,
			NOTICE_AT,
			OTHBC_AT,
			USE_AT,
			ATCH_FILE_ID,
			FRST_REGIST_PNTTM,
			FRST_REGISTER_ID,
			LAST_UPDT_PNTTM,
			LAST_UPDUSR_ID
		) values(	<!-- insert할 때 각 컬럼이 사용자에게 정보를 받아야하는지 DB에서 가져오는지 구분지어봐야햐한다. -->
			#{boardId},
			#{boardSj},
			#{boardCn},
			0,		<!-- 생성 시 조회수는 당연하게 0 -->
			#{creatIp},
			#{noticeAt},
			#{othbcAt},
			'Y', 	<!-- 생성 시 사용여부는 디폴트로 Y (이건 추후 관리로 변경함) -->
			#{atchFileId},
			now(),
			#{userId},
			now(),
			#{userId}
		)
	</insert>
</mapper>
